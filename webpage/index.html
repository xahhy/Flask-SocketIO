<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SocketIO</title>
    <script src="js/socket.io.js"></script>
    <script src="js/js.cookie.min.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
</head>
<div>
    <h1 id="user_id"></h1>
    <button id="btn_connect">connect</button>
    <button id="btn_disconnect">disconnect</button>
    <button id="btn_clear_cookie">clear cookie</button>
</div>
<script>
    var socket;
    var URL = 'http://127.0.0.1:5000';

    function set_socket() {
        var userId = Cookies.get('user_id');
        if (userId) {
            socket = io(URL + '/user', {
                query: {
                    user_id: userId
                }
            });
            $('#user_id').html(userId)
        } else {
            socket = io(URL + '/user');
        }
        socket.on('user_id', function (data) {
            console.log(data['user_id']);
            if (data['user_id']) {
                Cookies.set('user_id', data['user_id']);
                $('#user_id').html(data['user_id']);
            }
        });
    }
    set_socket();
    //socket.connect();

    $('#btn_connect').click(function () {
        set_socket();
        socket.connect();
        console.log('connect!')
    });
    $('#btn_disconnect').click(function () {
        socket.disconnect();
        console.log('disconnect!')
    });
    $('#btn_clear_cookie').click(function () {
        Cookies.remove('user_id')
    });
</script>
<body>

</body>
</html>
